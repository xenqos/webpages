<!doctype html>
<html>
<head>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=1.0'>
  <title>Textures</title>
  <link rel='icon' type='image/x-icon' href='../../../favicon.ico'>
  <link rel='icon' type='image/png' sizes='32x32'   href='../../../images/favicons/favicon-032.png'>
  <link rel='icon' type='image/png' sizes='128x128' href='../../../images/favicons/favicon-128.png'>
  <link rel='icon' type='image/png' sizes='180x180' href='../../../images/favicons/favicon-180.png'>
  <link rel='icon' type='image/png' sizes='192x192' href='../../../images/favicons/favicon-192.png'>
  <link rel='icon' type='image/png' sizes='512x512' href='../../../images/favicons/favicon-512.png'>
  <link rel='stylesheet' type='text/css' media='screen' href='../../../styles/global.css'>

<!-- ------------------------------------------------------------------------------------------- -->

<style>
/*-----------------------------------------------------------------------------------------------*/

.clFloor
{
  display:              flex;
  justify-content:      center;
}

/*
.clPokerTable
{
  background-color:     #0d6f3a;
  border-radius:        0.400rem;
  box-sizing:           border-box;
  display:              inline-flex;
  justify-content:      center;
  padding:              0.5rem;
  width:                auto;
}
*/

.clPokerTable
{
  background-color:     #0d6f3a;
  border-radius:        0.400rem;
  box-sizing:           border-box;
  display:              flex;
  justify-content:      center;
  padding:              0.5rem;
  width:                max-content;    /* Add this instead of inline-flex */
}

.clCard
{
  width:                14%;
  margin:               0 0.1rem;      /* Horizontal spacing only */
}

#idCard0,
#idCard1,
#idCard2
{
  margin-left:          0.100rem;
  margin-right:         0.100rem;
}

.clTexture
{
  margin:               0.000rem 0.000rem 0.000rem 1.000rem;
}

.clCategories
{
  margin:               0.000rem 0.000rem 0.000rem 2.000rem;
}

h3
{
  margin:               1.000rem 0.000rem 0.000rem -1.000rem;
}

.clStrategy
{
  margin:               0.000rem 0.000rem 0.000rem 1.000rem;
}

/*-----------------------------------------------------------------------------------------------*/

</style>

<!-- ------------------------------------------------------------------------------------------- -->

  <script type='text/javascript' src='../../../scripts/global.js'></script>

<!-- ------------------------------------------------------------------------------------------- -->

<script>

/*--------------------------------------------------------------------------------------------------*/

'use strict';

/*--------------------------------------------------------------------------------------------------*/

const conArrSuits = ['S', 'H', 'C', 'D'];
const conArrRanks = ['2', '3', '4', '5', '6', '7', '8', '9', 'T', 'J', 'Q', 'K', 'A'];
let arrCards = [];
let booTurn = false;
let objConsoleLog = null;
let objOutsDiv = null;
let objOutsTable = null;
let strOutsTable = '';

/*--------------------------------------------------------------------------------------------------*/

async function fncDealCards()
{
  arrCards.length = 0;
  objConsoleLog = document.getElementById('idConsoleLog');
  objConsoleLog.innerHTML = '';
  strOutsTable = '';

  while (arrCards.length < 3)
  {
    let numRankIndex = Math.floor(Math.random() * conArrRanks.length);
    let strRank = conArrRanks[numRankIndex];

    let numSuitIndex = Math.floor(Math.random() * conArrSuits.length);
    let strSuit = conArrSuits[numSuitIndex];

    let strCard = strRank + strSuit;

    if (!arrCards.includes(strCard))
    {
      arrCards.push(strCard);
    }
  }

  // Test Values Begin
  // arrCards = ['2H', '7C', '8S'];
  // Test Values End

  for (let numCounter = 0; numCounter < arrCards.length; numCounter++)
  {
    if (numCounter < 5)
    {
      document.getElementById('idCard' + numCounter).src = '../../../images/cards/' + arrCards[numCounter] + '.svg';
    }
    else
    {
      document.getElementById('idCard' + numCounter).src = '../../../images/cards/back.svg';
    }
  }

  fncIdentifyBoard();
}

/*--------------------------------------------------------------------------------------------------*/

async function fncIdentifyBoard()
{
  console.clear();
  console.log("Hand Tested: ", arrCards);

  // Extract ranks and suits from the cards
  const arrRanks = arrCards.map(card => card.charAt(0));
  const arrSuits = arrCards.map(card => card.charAt(1));

  // Convert ranks to numeric values
  const arrRankValues = arrRanks.map(strRank =>
  {
    const objRankMap =
    {
      '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9,
      'T': 10, 'J': 11, 'Q': 12, 'K': 13, 'A': 14
    };
    return objRankMap[strRank];
  });

  // Sort ranks for connectivity check
  const arrSortedRanks = [...arrRankValues].sort((a, b) => a - b);

  // Analyze board characteristics
  const objTexture = analyzeBoardTexture(arrRanks, arrSuits, arrRankValues, arrSortedRanks);

  // Update the HTML with texture information
  updateTextureDisplay(objTexture);
}

/*--------------------------------------------------------------------------------------------------*/

function analyzeBoardTexture(arrRanks, arrSuits, arrRankValues, arrSortedRanks)
{
  // Suit analysis
  const objSuitSet = new Set(arrSuits);
  const numSuitCount = objSuitSet.size;

  // Rank analysis
  const objRankSet = new Set(arrRanks);
  const numRankCount = objRankSet.size;
  const numRankDuplicates = 3 - numRankCount; // 0 = unpaired, 1 = paired, 2 = trips

  // Connectivity analysis
  const arrGaps = [];
  for (let numI = 1; numI < arrSortedRanks.length; numI++)
  {
    arrGaps.push(arrSortedRanks[numI] - arrSortedRanks[numI - 1] - 1);
  }
  const numTotalGaps = arrGaps.reduce((numSum, numGap) => numSum + numGap, 0);
  const booIsConnected = numTotalGaps <= 1; // Connected if 0 or 1 gap total

  // High/Low analysis
  const numAverageRank = arrRankValues.reduce((numSum, numRank) => numSum + numRank, 0) / 3;
  const numMaxRank = Math.max(...arrRankValues);
  const numMinRank = Math.min(...arrRankValues);

  // Determine coordination (Wet/Dry)
  let strCoordination = '';
  let strCoordinationDesc = '';
  let strCoordinationStrategy = '';

  // Coordination logic
  const booHasHighCards = arrRankValues.filter(numRank => numRank >= 10).length >= 2;
  const booHasBroadway = arrRankValues.filter(numRank => numRank >= 10).length >= 2;
  const booHasGutshot = numTotalGaps === 1;
  const booHasTwoGapper = numTotalGaps === 2;
  const booIsMonotone = numSuitCount === 1;
  const booIsTwoTone = numSuitCount === 2;

  if (booIsMonotone || booIsTwoTone || booHasHighCards || booIsConnected)
  {
    strCoordination = 'Wet';
    strCoordinationDesc = 'Board offers strong drawing potential with flush draws, straight draws, and high card potential.';
    strCoordinationStrategy = 'Play aggressively with strong hands and draws. Consider semi-bluffing with draws. Be cautious of possible made hands from opponents.';
  }
  else
  {
    strCoordination = 'Dry';
    strCoordinationDesc = 'Board has minimal drawing potential, likely consisting of low disconnected cards.';
    strCoordinationStrategy = 'Focus on value betting with made hands. Bluffing can be effective. Draws are less valuable.';
  }

  // Rank category
  let strRankCategory = '';
  let strRankDesc = '';
  if (numAverageRank >= 10)
  {
    strRankCategory = 'High Card Board / High Flop';
    strRankDesc = `Contains high cards (average rank: ${numAverageRank.toFixed(1)})`;
  }
  else if (numAverageRank <= 7)
  {
    strRankCategory = 'Low Card Board / Low Flop';
    strRankDesc = `Contains low cards (average rank: ${numAverageRank.toFixed(1)})`;
  }
  else
  {
    strRankCategory = 'Medium Flop';
    strRankDesc = `Contains medium cards (average rank: ${numAverageRank.toFixed(1)})`;
  }

  // Suitability
  let strSuitability = '';
  if (numSuitCount === 1)
  {
    strSuitability = 'Monotone';
  }
  else if (numSuitCount === 2)
  {
    strSuitability = 'Two-Tone';
  }
  else
  {
    strSuitability = 'Rainbow';
  }

  // Pairing category
  let strPairing = '';
  if (numRankCount === 3)
  {
    strPairing = 'Unpaired Board';
  }
  else if (numRankCount === 2 && numSuitCount === 3)
  {
    strPairing = 'Paired Rainbow';
  }
  else if (numRankCount === 2 && numSuitCount === 2)
  {
    strPairing = 'Paired Two-Tone';
  }
  else if (numRankCount === 1)
  {
    strPairing = 'Trips Board';
  }

  // Connectivity category
  let strConnectivity = booIsConnected ? 'Connected Flop' : 'Disconnected Flop';

  // Determine texture name based on priority from prompt
  let strTextureName = '';

  // Check in order of priority from prompt
  if (numRankCount === 1)
  {
    strTextureName = 'Trips';
  }
  else if (numSuitCount === 1)
  {
    strTextureName = 'Monotone';
  }
  else if (numSuitCount === 2 && numRankCount === 3)
  {
    strTextureName = 'Two Tone (Suited)';
  }
  else if (numSuitCount === 3 && numRankCount === 2)
  {
    strTextureName = 'Paired Rainbow';
  }
  else if (numSuitCount === 2 && numRankCount === 2)
  {
    strTextureName = 'Paired Two Tone';
  }
  else if (booIsConnected)
  {
    strTextureName = 'Connected Flop';
  }
  else if (numAverageRank >= 10)
  {
    strTextureName = 'High Flop';
  }
  else if (numAverageRank <= 7)
  {
    strTextureName = 'Low Flop';
  }
  else if (strCoordination === 'Wet')
  {
    strTextureName = 'Wet Flop';
  }
  else if (strCoordination === 'Dry')
  {
    strTextureName = 'Dry Flop';
  }
  else if (numSuitCount === 3 && numRankCount === 3)
  {
    strTextureName = 'Rainbow';
  }

  // Add high/low qualifier for certain textures
  if (strTextureName === 'Dry Flop' || strTextureName === 'Wet Flop' || strTextureName === 'Connected Flop')
  {
    if (numAverageRank >= 10)
    {
      strTextureName = 'High ' + strTextureName;
    }
    else if (numAverageRank <= 7)
    {
      strTextureName = 'Low ' + strTextureName;
    }
  }

  return {
    textureName: strTextureName,
    categories:
    {
      coordination: { name: strCoordination, desc: strCoordinationDesc, strategy: strCoordinationStrategy },
      rank: { name: strRankCategory, desc: strRankDesc },
      suitability: { name: strSuitability },
      pairing: { name: strPairing },
      connectivity: { name: strConnectivity }
    },
    rawData:
    {
      ranks: arrRanks,
      suits: arrSuits,
      rankValues: arrRankValues,
      averageRank: numAverageRank,
      suitCount: numSuitCount,
      rankCount: numRankCount,
      isConnected: booIsConnected,
      totalGaps: numTotalGaps
    }
  };
}

/*--------------------------------------------------------------------------------------------------*/

function updateTextureDisplay(objTexture)
{
  // Update texture name - keep <h2> and add <p> underneath
  const objTextureNameDiv = document.getElementById('idTextureName');
  objTextureNameDiv.innerHTML = `<h2>Name</h2><p class='clTexture'>${objTexture.textureName}</p>`;

  // Update texture category - keep <h2> and add content without table
  const objTextureCategoryDiv = document.createElement('div');
  objTextureCategoryDiv.id = 'idTextureCategory';
  objTextureCategoryDiv.innerHTML = '<h2>Category</h2>';

  // Create container for category items
  const objCategoryContainer = document.createElement('div');
  objCategoryContainer.className = 'clCategories';

  // Add coordination category
  addCategoryItem(objCategoryContainer, 'Coordination',
    `<strong>${objTexture.categories.coordination.name}</strong><br>${objTexture.categories.coordination.desc}`);

  // Add rank category
  addCategoryItem(objCategoryContainer, 'Rank',
    `<strong>${objTexture.categories.rank.name}</strong><br>${objTexture.categories.rank.desc}`);

  // Add suitability category
  addCategoryItem(objCategoryContainer, 'Suitability', objTexture.categories.suitability.name);

  // Add pairing category
  addCategoryItem(objCategoryContainer, 'Pairing', objTexture.categories.pairing.name);

  // Add connectivity category
  addCategoryItem(objCategoryContainer, 'Connectivity', objTexture.categories.connectivity.name);

  objTextureCategoryDiv.appendChild(objCategoryContainer);

  // Replace or insert the category div
  const objExistingCategoryDiv = document.getElementById('idTextureCategory');
  const objStrategyDiv = document.getElementById('idTextureStrategy');

  if (objExistingCategoryDiv)
  {
    objExistingCategoryDiv.replaceWith(objTextureCategoryDiv);
  }
  else
  {
    // Insert after texture name div
    objTextureNameDiv.after(objTextureCategoryDiv);
  }

  // Update strategy - keep <h2> and add <p> underneath
  objStrategyDiv.innerHTML = `<h2>Strategy</h2><p class='clStrategy'>${objTexture.categories.coordination.strategy}</p>`;

  // Log to console for debugging
  console.log('Board Texture Analysis:', objTexture);
}

/*--------------------------------------------------------------------------------------------------*/

function addCategoryItem(objContainer, strCategory, strValue)
{
  // Create category item container
  const objCategoryItem = document.createElement('div');

  // Create h3 for category title
  const objH3 = document.createElement('h3');
  objH3.textContent = strCategory;

  // Create div for value
  const objValueDiv = document.createElement('div');
  objValueDiv.innerHTML = strValue;

  // Add elements to category item
  objCategoryItem.appendChild(objH3);
  objCategoryItem.appendChild(objValueDiv);

  // Add category item to container
  objContainer.appendChild(objCategoryItem);
}

/*--------------------------------------------------------------------------------------------------*/
//  console.log('ZZZâ€¦');
/*--------------------------------------------------------------------------------------------------*/

</script>

<!-- ------------------------------------------------------------------------------------------- -->
</head>
<body onload='fncDealCards();'>
<div id='idPanel'>
<div id='idTopbar'>
  <div id='idTopbarNavigation'>
    <a href='../../../index.html'><span class='clNavHome'></span></a>
    <a href='../index.html'><span class='clNavIndex'></span></a>
  </div>
</div>
<div id='idContent'>

<h1>Textures</h1>

<div class='clFloor'>
<div class='clPokerTable'>
  <img id='idCard0' class='clCard' onclick='fncDealCards();'  src='../../../images/cards/back.svg'>
  <img id='idCard1' class='clCard' onclick='fncDealCards();'  src='../../../images/cards/back.svg'>
  <img id='idCard2' class='clCard' onclick='fncDealCards();'  src='../../../images/cards/back.svg'>
</div>
</div>

<div id='idTextureName'>
<h2>Name</h2>
</div>

<div id='idTextureCategory'>
<h2>Category</h2>
</div>

<div id='idTextureStrategy'>
<h2>Strategy</h2>
</div>


<code id='idConsoleLog'>
</code>

<br>

</div>
</div>
</body>
</html>
