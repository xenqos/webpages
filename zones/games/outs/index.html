<!doctype html>
<html>
<head>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=1.0'>
  <title>Outs</title>
  <link rel='icon' type='image/x-icon' href='../../../favicon.ico'>
  <link rel='icon' type='image/png' sizes='32x32'   href='../../../images/favicons/favicon-032.png'>
  <link rel='icon' type='image/png' sizes='128x128' href='../../../images/favicons/favicon-128.png'>
  <link rel='icon' type='image/png' sizes='180x180' href='../../../images/favicons/favicon-180.png'>
  <link rel='icon' type='image/png' sizes='192x192' href='../../../images/favicons/favicon-192.png'>
  <link rel='icon' type='image/png' sizes='512x512' href='../../../images/favicons/favicon-512.png'>
  <link rel='stylesheet' type='text/css' media='screen' href='../../../styles/global.css'>

<!-- ------------------------------------------------------------------------------------------- -->

<style>
/*-----------------------------------------------------------------------------------------------*/

.clFloor
{
  display:              flex;
  justify-content:      center;
}

.clPokerTable
{
  background-color:     #0d6f3a;
  border-radius:        0.400rem;
  box-sizing:           border-box;
/*
  display:              inline-block;
*/
  display:              flex;
  justify-content:      center;
  margin:               0.000rem 0.000rem 0.000rem 0.000rem;
  padding:              0.800rem 0.600rem 0.740rem 0.600rem;
  width:                100%;
}

.clCard
{
  width:                20%
}

#idCard0,
#idCard1,
#idCard2,
#idCard3,
#idCard4,
#idCard5
{
  margin-left:          0.100rem;
  margin-right:         0.100rem;
}

/*-----------------------------------------------------------------------------------------------*/

</style>

<!-- ------------------------------------------------------------------------------------------- -->

  <script type='text/javascript' src='../../../scripts/global.js'></script>

<!-- ------------------------------------------------------------------------------------------- -->

<script>

/*--------------------------------------------------------------------------------------------------*/

'use strict';

/*--------------------------------------------------------------------------------------------------*/

const arrSuits = ['S', 'H', 'C', 'D'];
const arrRanks = ['2', '3', '4', '5', '6', '7', '8', '9', 'T', 'J', 'Q', 'K', 'A'];
let arrCards = [];
let booTurn = false;
let objConsoleLog = null;
let objOutsDiv = null;
let objOutsTable = null;
let strOutsTable = '';

/*--------------------------------------------------------------------------------------------------*/

async function fncDealCards()
{
  arrCards.length = 0;
  objConsoleLog = document.getElementById('idConsoleLog');
  objOutsDiv = document.getElementById('idOutsDiv');
  objOutsTable = document.getElementById('idOutsTable');
  objConsoleLog.innerHTML = '';
  objOutsDiv.innerHTML = '';
  objOutsTable.innerHTML = '';
  strOutsTable = '';

  while (arrCards.length < 6)
  {
    let numRankIndex = Math.floor(Math.random() * arrRanks.length);
    let strRank = arrRanks[numRankIndex];

    let numSuitIndex = Math.floor(Math.random() * arrSuits.length);
    let strSuit = arrSuits[numSuitIndex];

    let strCard = strRank + strSuit;

    if (!arrCards.includes(strCard))
    {
      arrCards.push(strCard);
    }
  }

// Test Values Begin
// arrCards = ['2H', '7C', '8S', '5D', '4C', 'KS'];
// Test Values End

  for (let numCounter = 0; numCounter < arrCards.length; numCounter++)
  {
    if (numCounter < 5)
    {
      document.getElementById('idCard' + numCounter).src = '../../../images/cards/' + arrCards[numCounter] + '.svg';
    }
    else
    {
      document.getElementById('idCard' + numCounter).src = '../../../images/cards/back.svg';
    }
  }

  fncCountOuts();
}

/*--------------------------------------------------------------------------------------------------*/

async function fncShowTurn()
{
  if (booTurn === false)
  {
    document.getElementById('idCard5').src = '../../../images/cards/' + arrCards[5] + '.svg';
    booTurn = true;
  }
  else
  {
    booTurn = false;
    fncDealCards();
  }
}

/*--------------------------------------------------------------------------------------------------*/

async function fncCountOuts()
{
  console.clear();
  console.log("Hand Tested: ", arrCards);

  // Clear previous output
  const objOutsTable = document.getElementById('idOutsTable');
  let strOutsTable = '<br><table class="clNoBorder"><tbody>';

  const arrOutsNames = [
    "One Pair to Set", "One Pair to Trips", "One Overcard to Pair", "Inside Straight Draw", "Two Pair to Full House",
    "One Pair to Two Pair", "No Pair to Pair", "Set to Full House", "Trips to Full House",
    "Two Overcards to Over Pair", "Set to Quads", "Set to Four of a Kind", "Open-Ended Straight Draw",
    "Flush Draw", "Inside Straight Draw & Two Overcards", "Inside Straight Draw & Flush",
    "Open Straight Draw & Flush Draw"
  ];

  // Helpers
  const fncGetRank = (strCard) => '23456789TJQKA'.indexOf(strCard[0]) + 2;
  const fncGetSuit = (strCard) => 'SHCD'.indexOf(strCard[1]);

  // Process both stages: Flop (5 cards) and Turn (6 cards)
  const fncProcessStage = (numCards, strStageName) =>
  {
    const blnIsFlop = (strStageName === "Flop");
    const arrStageCards = arrCards.slice(0, numCards);

    // Rank & suit counts
    const arrRankCount    = Array(15).fill(0);  // index 2..14 (A)
    const arrSuitCount    = Array(4).fill(0);
    const arrPresentRanks = Array(15).fill(0);

    arrStageCards.forEach(strCard =>
    {
      const numRank = fncGetRank(strCard);
      const numSuit = fncGetSuit(strCard);
      arrRankCount[numRank]++;
      arrSuitCount[numSuit]++;
      arrPresentRanks[numRank] = 1;
    });

    const numHole1Rank   = fncGetRank(arrCards[0]);
    const numHole2Rank   = fncGetRank(arrCards[1]);
    const blnIsPocketPair = numHole1Rank === numHole2Rank;

    let objOuts = {
      numPairToSet:      0,
      numOnePairToTrips: 0,
      numNoPairToPair:   0,
      numTwoPairToFH:    0,
      numSetToFH:        0,
      numTripsToFH:      0,
      numSetToQuads:     0,
      numOesd:           0,
      numGutshot:        0,
      numFlushDraw:      0
    };

    // === 1. Made hands & improvement outs ===
    let numPairs   = 0;
    let numTrips   = 0;
    let numQuads   = 0;
    let numTripRank = -1;

    for (let numR = 2; numR <= 14; numR++)
    {
      if (arrRankCount[numR] === 2) numPairs++;
      if (arrRankCount[numR] === 3)
      {
        numTrips++;
        numTripRank = numR;
      }
      if (arrRankCount[numR] === 4) numQuads++;
    }

    if (numTrips === 1)
    {
      const blnYouHaveSet   = blnIsPocketPair && numHole1Rank === numTripRank;
      const blnYouHaveTrips = (numHole1Rank === numTripRank || numHole2Rank === numTripRank);

      if (blnYouHaveSet || blnYouHaveTrips) objOuts.numSetToQuads = 1;

      let numSingletons = 0;
      for (let numR = 2; numR <= 14; numR++)
      {
        if (arrRankCount[numR] === 1) numSingletons++;
      }

      if (blnYouHaveSet)                  objOuts.numSetToFH   = 3 * numSingletons;
      if (blnYouHaveTrips && !blnYouHaveSet) objOuts.numTripsToFH = 3 * numSingletons;
    }
    else if (numPairs >= 2)
    {
      objOuts.numTwoPairToFH = 4;
    }
    else if (numPairs === 1)
    {
      let numPairedRank = -1;
      for (let numR = 2; numR <= 14; numR++)
      {
        if (arrRankCount[numR] === 2) numPairedRank = numR;
      }

      if (numHole1Rank === numPairedRank || numHole2Rank === numPairedRank)
      {
        objOuts.numOnePairToTrips = 2;
      }
    }

    // === 2. Pocket pair or unpaired hole cards ===
    if (numPairs === 0 && numTrips === 0)
    {
      if (blnIsPocketPair)
      {
        objOuts.numPairToSet = 2;
      }
      else
      {
        let numOuts1 = 3 - arrRankCount[numHole1Rank] + 1;
        let numOuts2 = 3 - arrRankCount[numHole2Rank] + 1;
        objOuts.numNoPairToPair = Math.max(0, numOuts1) + Math.max(0, numOuts2);
      }
    }

    // Special case: board has trips, you have nothing in it
    if (numTrips === 1 && numHole1Rank !== numTripRank && numHole2Rank !== numTripRank)
    {
      let numFhOuts = 0;
      if (arrRankCount[numHole1Rank] === 1) numFhOuts += 2;
      if (arrRankCount[numHole2Rank] === 1) numFhOuts += 2;
      objOuts.numNoPairToPair = numFhOuts;
    }

    // === 3. Straight draws ===
    const fncCheckStraightOuts = () =>
    {
      let numOesd    = 0;
      let numGutshot = 0;

      // Wheel check (A-5)
      if (arrPresentRanks[14] && arrPresentRanks[2] && arrPresentRanks[3] && arrPresentRanks[4] && arrPresentRanks[5])
      {
        if (!arrPresentRanks[6]) numOesd += 4;
      }

      for (let numLow = 2; numLow <= 10; numLow++)
      {
        const arrWindow = [numLow, numLow+1, numLow+2, numLow+3, numLow+4];
        let numHave = 0;
        let numGaps = 0;

        arrWindow.forEach(numR =>
        {
          if (arrPresentRanks[numR]) numHave++;
          else numGaps++;
        });

        if (numHave === 4 && numGaps === 1)
        {
          const numMissing = arrWindow.find(numR => !arrPresentRanks[numR]);
          if (numMissing === numLow || numMissing === numLow + 4) numOesd += 4;
          else numGutshot += 4;
        }
        if (numHave === 3 && numGaps === 2)
        {
          const arrMissing = arrWindow.filter(numR => !arrPresentRanks[numR]);
          if ((arrMissing[0] === numLow && arrMissing[1] === numLow + 4) ||
              (arrMissing[1] === numLow && arrMissing[0] === numLow + 4))
          {
            numOesd += 8;   // double gutshot treated as strong OESD
          }
        }
      }
      return { numOesd, numGutshot };
    };

    const objStraight = fncCheckStraightOuts();
    objOuts.numOesd    = objStraight.numOesd;
    objOuts.numGutshot = objStraight.numGutshot;

    // === 4. Flush draw ===
    const numMaxSuit = Math.max(...arrSuitCount);
    if (numMaxSuit === 4) objOuts.numFlushDraw = 9;
    else if (numMaxSuit === 5) objOuts.numFlushDraw = 0;

    // === 5. Total outs (draws + improvements) ===
    let numTotalOuts = 0;

    if (objOuts.numGutshot > 0 && objOuts.numFlushDraw > 0)
    {
      numTotalOuts = 12;   // 4 + 9 - 1 overlap
    }
    else if (objOuts.numOesd > 0 && objOuts.numFlushDraw > 0)
    {
      numTotalOuts = 15;   // 8 + 9 - 2 overlap
    }
    else
    {
      numTotalOuts = objOuts.numOesd + objOuts.numGutshot + objOuts.numFlushDraw;
    }

    numTotalOuts += objOuts.numPairToSet + objOuts.numOnePairToTrips + objOuts.numNoPairToPair +
                    objOuts.numTwoPairToFH + objOuts.numSetToFH + objOuts.numTripsToFH + objOuts.numSetToQuads;

    // === 6. Output array for display ===
    const arrOutDisplay = [
      objOuts.numPairToSet,
      objOuts.numOnePairToTrips,
      0,                                                        // One Overcard (not tracked)
      objOuts.numGutshot > 0 ? 4 : 0,                            // Inside Straight Draw
      objOuts.numTwoPairToFH,
      0,                                                        // One Pair to Two Pair
      objOuts.numNoPairToPair,
      objOuts.numSetToFH,
      objOuts.numTripsToFH,
      0,                                                        // Two Overcards
      objOuts.numSetToQuads,
      objOuts.numSetToQuads,                                    // duplicate for display
      objOuts.numOesd > 0 ? 8 : 0,                               // OESD
      objOuts.numFlushDraw,
      0,                                                        // Inside + Overcards
      objOuts.numGutshot > 0 && objOuts.numFlushDraw > 0 ? 12 : 0,
      objOuts.numOesd > 0 && objOuts.numFlushDraw > 0 ? 15 : 0
    ];

    // === 7. Render table ===
    strOutsTable += `<tr><td colspan=2 class='m'><b>${strStageName}</b></td></tr>`;

    for (let numI = 0; numI < arrOutsNames.length; numI++)
    {
      const strName = arrOutsNames[numI];
      const numVal  = arrOutDisplay[numI];

      // Hide individual draws when combo draw exists
      if ((strName === "Inside Straight Draw" || strName === "Flush Draw") &&
          (arrOutDisplay[15] > 0 || arrOutDisplay[16] > 0)) continue;

      if ((strName === "Open-Ended Straight Draw" || strName === "Flush Draw") &&
          arrOutDisplay[16] > 0) continue;

      if (numVal > 0)
      {
        console.log(`${strName} - ${numVal}`);
        strOutsTable += `<tr><td>${strName}</td><td>${numVal}</td></tr>`;
      }
    }

    console.log(`Total Outs after ${strStageName} - ${numTotalOuts}`);
    strOutsTable += `<tr><td>Total</td><td class='e'><b>${numTotalOuts}</b><br><br></td></tr>`;
    if (!blnIsFlop) strOutsTable += `<tr><td colspan=2>&nbsp;</td></tr>`;
  };

  // === Run both stages ===
  fncProcessStage(5, "Flop");
  if (arrCards.length >= 6) fncProcessStage(6, "Turn");

  strOutsTable += `</tbody></table>`;
  objOutsTable.innerHTML = strOutsTable;
}

/*--------------------------------------------------------------------------------------------------*/
//  console.log('ZZZâ€¦');
/*--------------------------------------------------------------------------------------------------*/

</script>

<!-- ------------------------------------------------------------------------------------------- -->
</head>
<body onload='fncDealCards();'>
<div id='idPanel'>
<div id='idTopbar'>
  <div id='idTopbarNavigation'>
    <a href='../../../index.html'><span class='clNavHome'></span></a>
    <a href='../index.html'><span class='clNavIndex'></span></a>
  </div>
</div>
<div id='idContent'>

<h1>Outs</h1>

<div class='clFloor'>
<div class='clPokerTable'>
  <img id='idCard0' class='clCard' onclick='fncDealCards();'  src='../../../images/cards/back.svg'>
  <img id='idCard1' class='clCard' onclick='fncDealCards();'  src='../../../images/cards/back.svg'>
  <img id='idCard2' class='clCard' onclick='fncDealCards();'  src='../../../images/cards/back.svg'>
  <img id='idCard3' class='clCard' onclick='fncDealCards();'  src='../../../images/cards/back.svg'>
  <img id='idCard4' class='clCard' onclick='fncDealCards();'  src='../../../images/cards/back.svg'>
  <img id='idCard5' class='clCard' onclick='fncShowTurn();'   src='../../../images/cards/back.svg'>
</div>
</div>

<!--
  <img id='idCard0' class='clCard' onclick='fncDealCards()'  src='../../../images/cards/back.svg'>
  <img id='idCard1' class='clCard' onclick='fncDealCards()'  src='../../../images/cards/back.svg'>
  <img id='idCard2' class='clCard' onclick='fncDealCards()'  src='../../../images/cards/back.svg'>
  <img id='idCard3' class='clCard' onclick='fncDealCards()'  src='../../../images/cards/back.svg'>
  <img id='idCard4' class='clCard' onclick='fncDealCards()'  src='../../../images/cards/back.svg'>
  <img id='idCard5' class='clCard' onclick='fncShowTurn()'   src='../../../images/cards/back.svg'>
-->

<div id='idOutsTable'>
</div>

<div id='idOutsDiv'>
</div>

<code id='idConsoleLog'>
</code>

<br>

</div>
</div>
</body>
</html>
